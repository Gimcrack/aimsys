function closeAllTabs(){delete Tabs.activeTab,delete Tabs.lastActiveTab,delete Tabs.relatedCol,$.each(Tabs,function(t,e){e.closeTab()})}function firstNonSpecial(t){return $keys=$.map(t,function(t,e){return"activeTab"!=e&&"lastActiveTab"!=e&&"relatedCol"!=e&&"function"!=typeof e?e:void 0}),$keys[0]}function Tab(t){this.id=null,this.table=null,this.$id=null,this.name=null,this.$tab=null,this.$content=null,this.type="undefined"==typeof t?"qv":t,this.editing=!1,this.json=[],this.oJSON=[],this.subtab=0,this.popupTab=[],this.tempVals=[],this.newTab=function(t,e){this.id=t,this.table=t.substr(0,t.indexOf("__")),this.$id="#"+this.id,this.name=e,this.is_new=-1!==this.id.indexOf("__new")?!0:!1,this.editing=this.is_new?!0:this.editing,this.tabExists()?this.showTab():this.createTab()},this.createTab=function(){"qv"==this.type?$("<li/>",{"class":"ui-corner-top",id:this.id,type:this.type,name:this.name}).html(this.name+'<div class="close-icon"></div>').appendTo("#tab-bar ul"):$("<li/>",{"class":"ui-corner-top",id:this.id,type:this.type,name:this.name}).html(this.name).appendTo("#tab-bar ul"),$("<div/>",{"class":"main-content",id:this.id}).appendTo("#main"),this.$tab=$(this.$id,"#tab-bar ul"),this.$content=$(this.$id,"#main"),this.getHTML(),this.showTab(),this.resetTabBindings()},this.update_select_options=function(t){$o={},$o.table=Tabs.activeTab.table,$o.col=this.popupTab.$select_id,$o.value=t,$target=$("#"+Tabs.activeTab.popupTab.$select_id,Tabs.activeTab.$content),$url="index.php?controller=input&option=update_options",$qs=$.param($o),maskAll("Updating..."),aj=$.ajax({url:$url,data:$qs,type:"POST",success:function(t){$target.html(t),unmaskAll()}})},this.popup=function(t,e,a){$("#div_tab_popup","#main").length>0&&$("#div_tab_popup","#main").remove(),$("<div/>",{id:"div_tab_popup"}).hide().appendTo("#main"),this.popupTab.table=t,this.popupTab.title=a,this.popupTab.dlog=null,this.popupTab.$divid="#div_tab_popup",this.popupTab.$select_id=e,this.popupTab.showPopup=function(){Tabs.activeTab.popupTab.dlog=$(Tabs.activeTab.popupTab.$divid).dialog({resizable:!0,width:600,modal:!0,title:a,position:{my:"top",at:"top+200",of:window},buttons:{Cancel:function(){noty({text:"Are you sure you want to cancel new record?<br/>This action cannot be undone!",modal:!0,layout:"center",buttons:[{addClass:"btn btn-primary",text:"Keep Editing",onClick:function(t){t.close()}},{addClass:"btn btn-danger",text:"Cancel New Record",onClick:function(t){t.close(),Tabs.activeTab.popupTab.dlog.dialog("destroy"),$("#"+Tabs.relatedCol,Tabs.activeTab.$content).prop("selectedIndex",0)}}]})},Reset:function(){$("#frm_editor",this)[0].reset()},"Save & Close":function(){$frm=$("#frm_editor",this),$frm_valid=validate_form($frm),$frm_valid&&editor_submit_popup($frm)}}})},this.popupTab.hidePopup=function(){Tabs.activeTab.popupTab.dlog.dialog("close")},this.popupTab.loadHTML=function(){$target=$("#div_tab_popup","#main"),$url="index.php?controller=tab&option=popup&table="+Tabs.activeTab.popupTab.table+"&rowid=new",aj=$.ajax({url:$url,success:function(t){$target.html(t),Tabs.activeTab.popupTab.showPopup()}})},this.popupTab.loadHTML()},this.loadJSON=function(t){this.json[this.subtab]!=t&&(this.json[this.subtab]=t,this.oJSON[this.subtab]=o=$.parseJSON(t),$target=$(this.$content).find(".part.active"),o[0].page=Number(parseInt(o[0].page)),o[0].total_pages=Number(parseInt(o[0].total_pages)),o[0].total_rows=Number(parseInt(o[0].total_rows)),$cols=$(".qv-col",$target),$cols.each(function(){$(".qv-cell:gt(1)",$(this)).remove()}),$.each(o,function(t,e){t>0&&$.each(e,function(e,a){$("<div/>",{"class":"qv-cell"}).html(a).appendTo($cols.eq(Number(t-1)))})}),Boolean(o[0].buttons.first_page)&&$target.find("#lb-first, #lb-prev").removeClass("disabled").removeClass("l-btn-disabled"),Boolean(o[0].buttons.next_page)&&$target.find("#lb-next, #lb-last").removeClass("disabled").removeClass("l-btn-disabled"),1==o[0].page&&$target.find("#lb-first, #lb-prev").addClass("disabled").addClass("l-btn-disabled"),o[0].page==o[0].total_pages&&$target.find("#lb-next, #lb-last").addClass("disabled").addClass("l-btn-disabled"),1==o[0].total_pages?($target.find("#lb-first, #lb-prev, #lb-next, #lb-last").addClass("disabled").addClass("l-btn-disabled"),$target.find("#txt_page_number").prop("readonly",!0).addClass("ui-state-disabled")):$target.find("#txt_page_number").prop("readonly",!1).removeClass("ui-state-disabled"),0!=o[0].total_rows?$target.find("#spn_pagination_controls").show():$target.find("#spn_pagination_controls").hide(),$target.find("#txt_page_number").val(o[0].page),$target.find("#rows_per_page").val(o[0].rows_per_page),$target.find("#spn_total_pages").html(o[0].total_pages),$target.find("#row_message").html(o[0].row_message).removeClass("ui-state-error").removeClass("ui-state-success").addClass(o[0].row_message_class),this.resetQVBindings())},this.storeTabs=function(){var t,e={};$("#tab-bar ul li").each(function(){e[$(this).attr("id")]=$(this).hasClass("active")?{id:$(this).attr("id"),name:$(this).attr("name"),type:$(this).attr("type"),active:!0}:{id:$(this).attr("id"),name:$(this).attr("name"),type:$(this).attr("type"),active:!1}}),"undefined"!=typeof t&&t.abort(),t=$.ajax({url:"index.php?controller=form&frm_name=frm_storetabs",data:"Tabs="+JSON.stringify(e),success:function(){noty_message("Tab Layout Saved","success")},type:"POST"})},this.restoreTabs=function(){var t;"undefined"!=typeof t&&t.abort(),t=$.ajax({url:"index.php?controller=form&frm_name=frm_gettabs",success:function(){console.log("Get tabs... done")},type:"POST",dataType:"script"})},this.tabExists=function(){return Boolean($(this.$id,"#main").length>0&&""!=$(this.$id,"#main").html())},this.showTab=function(){Tabs.lastActiveTab=Tabs.activeTab,$(".active","#tab-bar").removeClass("active"),$(".main-content.active","#main").removeClass("active"),$(this.$id,"#tab-bar ul").addClass("active"),$(this.$id,"#main").addClass("active"),Tabs.activeTab=this,$("#tab-bar ul").sortable()},this.new2view=function(t,e){this.closeTab();var a=t+"__"+e;Tabs[a]=new Tab("editor");var i=this.name.replace("[new]",$("input[type=text]",this.$content).eq(0).val());Tabs[a].newTab(a,i)},this.refreshEditing=function(t){this.editing=!0,Tabs.activeTab.tempVals=[],$fields=$("input,select",Tabs.activeTab.$content),$.each($fields,function(){Tabs.activeTab.tempVals.push({key:$(this).attr("id"),value:$(this).val()})}),isasync=!1,temp=this.id.split("__"),table=temp[0],cid=this.is_new?"new":1*Number(temp[1]),$url="index.php?controller=tab&option=refresh_edit&table="+table+"&rowid="+cid+"&editing=1",target=$("#div-editor",this.$content),aj=$.ajax({url:$url,success:function(e){target.html()!=e&&target.html(e),$.each(Tabs.activeTab.tempVals,function(t,e){$("[name="+e.key+"]",Tabs.activeTab.$content).val(e.value)}),target_select=$("#"+Tabs.relatedCol),$("option",target_select).each(function(e){$("option",target_select).eq(e).prop("selected",$("option",target_select).eq(e).attr("value")==t)})}})},this.getHTML=function(){var t,e=this.$content;switch(maskAll(),this.type){case"qv":$url=$(this.$id,"#left").find("a").eq(0).attr("href"),isasync=!0;break;case"editor":isasync=!0,temp=this.id.split("__"),table=temp[0],cid=this.is_new?"new":1*Number(temp[1]),popup="popup"==this.format?1:0,editing=this.editing?1:0,$url="index.php?controller=tab&option=editor&table="+table+"&rowid="+cid+"&popup="+popup+"&editing="+editing}t=$.ajax({url:$url,async:isasync,success:function(t){e.html()!=t&&e.html(t),unmaskAll()}})},this.closeTab=function(){this.$tab=$(this.$id,"#tab-bar ul"),this.$content=$(this.$id,"#main"),Tabs[this.id].$tab.remove(),Tabs[this.id].$content.remove(),delete Tabs[this.id],Tabs.activeTab.editing||Tabs.activeTab.refreshTab(),$(Tabs.lastActiveTab.$id).length>0?Tabs.lastActiveTab.showTab():Tabs[firstNonSpecial(Tabs)].showTab()},this.refreshTab=function(){switch(this.type){case"qv":ajax_submit_filter();break;case"editor":case"other":this.getHTML()}},this.refreshBindings=function(){switch(this.type){case"qv":this.resetQVBindings();break;case"editor":case"other":this.resetEditorBindings()}},this.resetTabBindings=function(){$("#tab-bar ul li").off("click.tabBindings").on("click.tabBindings",function(){var t=$(this).attr("id");Tabs.activeTab.id!=t&&(Tabs[t].showTab(),0==Tabs.activeTab.editing&&0==Tabs.activeTab.is_new&&Tabs[t].refreshTab(),Tabs[t].refreshBindings())}),$(".close-icon").off("click.closeIcon").on("click.closeIcon",function(){var t=$(this).parent().attr("id");Tabs.activeTab.id==t&&Tabs[t].closeTab()})},this.resetQVBindings=function(){ajax_submit_filter(),$target=$(this.$content).find(".part.active"),$(".easyui-linkbutton",$target).off(),$("select#rows_per_page",$target).unbind("change").change(function(){$("#hid_rows_per_page",$target).val($(this).val()),$("#hid_page_number",$target).val(1),ajax_submit_filter()}),$("input#txt_page_number",$target).unbind("keypress").keypress(function(t){$(this).val($(this).val().formatInteger()),13==t.which&&($(this).blur(),ajax_submit_filter())}).unbind("change").change(function(){1*$(this).val()>1*$("#hid_total_pages",$target).val()&&$(this).val($("#hid_total_pages",$target).val()),$("#hid_page_number",$target).val($(this).val()),ajax_submit_filter()}),$("#lb-first:not('.disabled')",$target).click(function(){$("input#txt_page_number",$target).val(1).trigger("change")}),$("#lb-prev:not('.disabled')",$target).click(function(){$("input#txt_page_number",$target).val(1*$("input#txt_page_number",$target).val()-1).trigger("change")}),$("#lb-next:not('.disabled')",$target).click(function(){$("input#txt_page_number",$target).val(1*$("input#txt_page_number",$target).val()+1).trigger("change")}),$("#lb-last:not('.disabled')",$target).click(function(){$("input#txt_page_number",$target).val($("#hid_total_pages",$target).val()).trigger("change")}),$("#lb-go",$target).click(function(){$("#hid_page_number",".part.active .form_filter").val(1),ajax_submit_filter()}),$("#lb-reset",$target).click(function(){$(".input-qv-cell-search",$target).val(""),$("#hid_page_number",$target).val(1),$("#hid_dir",$target).val("ASC"),$("#hid_order",$target).val(""),ajax_submit_filter()}),$("#lb-refresh",$target).click(function(){ajax_submit_filter()}),$("#lb-new",$target).click(function(){var t=$(this).attr("name"),e=$(this).attr("rel");Tabs[e]=new Tab("editor"),Tabs[e].newTab(e,t+" . [new]")}),$(".qv-a",$target).unbind("click").click(function(){var t=$(this).closest(".qv-table"),e=t.attr("name"),a=$(this).html(),i=$(this).attr("rel");Tabs[i]=new Tab("editor"),Tabs[i].newTab(i,e+" . "+a)}),$(".qv-table .qv-col .qv-cell").mouseover(function(){$table=$(this).closest(".qv-table"),$index=$(this).index(),$index>1&&$(".qv-col",$table).each(function(t,e){$(".qv-cell",e).eq($index).addClass("highlight")})}).mouseout(function(){$table=$(this).closest(".qv-table"),$index=$(this).index(),$index>1&&$(".qv-col",$table).each(function(t,e){$(".qv-cell",e).eq($index).removeClass("highlight")})}),$(".input-qv-cell-search",$target).keypress(function(t){13==t.which&&($(this).blur(),$("#hid_page_number",$target).val(1),ajax_submit_filter())}),$("select#rows_per_page",$target).change(function(){$("#hid_rows_per_page",$target).val($(this).val()),$("#hid_page_number",$target).val(1),ajax_submit_filter()}),$("input#txt_page_number",$target).keypress(function(t){$(this).val($(this).val().formatInteger()),13==t.which&&($(this).blur(),ajax_submit_filter())}).change(function(){1*$(this).val()>1*$("#hid_total_pages",$target).val()&&$(this).val($("#hid_total_pages",$target).val()),$("#hid_page_number",$target).val($(this).val()),ajax_submit_filter()})},this.resetEditorBindings=function(){$target=$(".part",this.$content).eq(this.subtab),$("button",$target).button(),$frm=$(".main-content.active .part.active #frm_editor"),$(".easyui-linkbutton",$target).unbind("click"),$("#lb-refresh",$target).click(function(){Tabs.activeTab.refreshTab()}),$("#lb-edit",$target).click(function(){Tabs.activeTab.editing=!0,checkout_message("Refreshing..."),Tabs.activeTab.refreshTab()}),$("#lb-save",$target).click(function(){$frm=$(".main-content.active .part.active #frm_editor"),$frm_valid=validate_form($frm),$frm_valid&&editor_submit($frm)}),$("#lb-reset",$target).click(function(){$frm=$(".main-content.active .part.active #frm_editor"),$frm[0].reset()}),$("#lb-close",$target).click(function(){Tabs.activeTab.editing=!1,Tabs.activeTab.closeTab()}),$("#lb-cancel",$target).click(function(){$frm=$(".main-content.active .part.active #frm_editor"),Tabs.activeTab.is_new?noty({text:"Are you sure you want to cancel new record?<br/>This action cannot be undone!",modal:!0,layout:"center",buttons:[{addClass:"btn btn-primary",text:"Keep Editing",onClick:function(t){t.close()}},{addClass:"btn btn-danger",text:"Cancel New Record",onClick:function(t){t.close(),Tabs.activeTab.editing=!1,Tabs.activeTab.closeTab()}}]}):noty({text:"Are you sure you want to cancel changes?<br/>This action cannot be undone!",modal:!0,layout:"center",buttons:[{addClass:"btn btn-primary",text:"Keep Editing",onClick:function(t){t.close()}},{addClass:"btn btn-danger",text:"Cancel Changes",onClick:function(t){t.close(),Tabs.activeTab.editing=!1,$frm[0].reset(),checkin($qs)}}]})})}}function view_record(t,e){$select=$(e,Tabs.activeTab.$content),$selectedoption=$(":selected",$select),$tabid=t+"__"+$selectedoption.attr("value"),$friendly_table=t.replace("aim","").replace("_"," ").ucwords(),$friendly_record=$selectedoption.html(),Tabs[$tabid]=new Tab("editor"),Tabs[$tabid].newTab($tabid,$friendly_table+" . "+$friendly_record)}var Tabs={};Tabs.activeTab=null,Tabs.lastActiveTab=null,Tabs.relatedCol=null;